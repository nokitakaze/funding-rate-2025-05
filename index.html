<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Prices & Funding</title>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <style>
        #graph {
            height: 90vh;
            min-width: 310px;
        }
    </style>
</head>
<body>
<div id="graph"></div>

<script type="module">
    async function load(p) {
        const r = await fetch(p);
        if (!r.ok) {
            throw new Error(`Не удалось загрузить ${p}`);
        }
        return r.json();
    }

    const toSeries = (a, i) => a
        .map(d => [d[0] * 1000, d[i] ?? null])
        .filter(d => d[1] !== null);

    (async () => {
        const [btc, eth, sol] = await Promise.all([
            load('data-BTC.json'),
            load('data-ETH.json'),
            load('data-SOL.json')
        ]);

        Highcharts.stockChart('graph', {
            rangeSelector: {selected: 1},
            title: {text: 'Цены и ставки фандинга'},
            legend: {enabled: true},
            yAxis: [{
                title: {text: 'Funding (abs)'},
                labels: {format: '{value:.4f}'}
            }, {
                title: {text: 'Price, USD'},
                opposite: true,
                labels: {format: '{value:.2f}'}
            }],
            tooltip: {shared: true},
            series: [
                {name: 'BTC Price', data: toSeries(btc, 1), yAxis: 1, connectNulls: true, tooltip: {valueDecimals: 2}},
                {name: 'ETH Price', data: toSeries(eth, 1), yAxis: 1, connectNulls: true, tooltip: {valueDecimals: 2}},
                {name: 'SOL Price', data: toSeries(sol, 1), yAxis: 1, connectNulls: true, tooltip: {valueDecimals: 2}},

                {name: 'BTC Funding Binance', data: toSeries(btc, 2), yAxis: 0, connectNulls: true, tooltip: {valueDecimals: 6}},
                {name: 'BTC Funding Bybit', data: toSeries(btc, 3), yAxis: 0, connectNulls: true, tooltip: {valueDecimals: 6}},
                {name: 'ETH Funding Binance', data: toSeries(eth, 2), yAxis: 0, connectNulls: true, tooltip: {valueDecimals: 6}},
                {name: 'ETH Funding Bybit', data: toSeries(eth, 3), yAxis: 0, connectNulls: true, tooltip: {valueDecimals: 6}},
                {name: 'SOL Funding Binance', data: toSeries(sol, 2), yAxis: 0, connectNulls: true, tooltip: {valueDecimals: 6}},
                {name: 'SOL Funding Bybit', data: toSeries(sol, 3), yAxis: 0, connectNulls: true, tooltip: {valueDecimals: 6}}
            ]
        });
    })().catch(console.error);
</script>
</body>
</html>
